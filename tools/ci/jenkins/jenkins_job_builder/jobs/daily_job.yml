- defaults:
    name: daily_job_defaults
    project-type: freestyle
    description: DO NOT EDIT MANUALLY THROUGH JENKINS WEB UI - Config in vendor/volvocars/tools/ci/jenkins_job_builder
    concurrent: false
    properties:
        - build-discarder:
            days-to-keep: 30
            artifact-days-to-keep: 30
        - raw:
            xml: |
                <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@1.25">
                    <autoRebuild>false</autoRebuild>
                    <rebuildDisabled>false</rebuildDisabled>
                </com.sonyericsson.rebuild.RebuildSettings>
    notifications:
        - http:
            url: http://10.251.165.223:5000/events
            format: json
            event: all
            timeout: 10000
            log: 0
    wrappers:
        - timestamps
        - timeout:
            timeout: 240
            timeout-var: 'BUILD_TIMEOUT'
            abort: true
            type: absolute
        - raw:
            xml: |
                    <org.jenkinsci.plugins.credentialsbinding.impl.SecretBuildWrapper plugin="credentials-binding@1.10">
                        <bindings>
                            <org.jenkinsci.plugins.credentialsbinding.impl.StringBinding>
                                <credentialsId>SWF1_ARTIFACTORY_API_KEY</credentialsId>
                                <variable>ARTIFACTORY_API_KEY</variable>
                            </org.jenkinsci.plugins.credentialsbinding.impl.StringBinding>
                        </bindings>
                    </org.jenkinsci.plugins.credentialsbinding.impl.SecretBuildWrapper>

- job:
    name: ihu_daily
    project-type: multijob
    description: Link to test report - http://gotsvl1416.got.volvocars.net/daily_test_report/<BUILD_NUMBER>
    node: high
    scm:
        - git:
            url: ssh://gotsvl1415.got.volvocars.net:29421/manifest
            credentials-id: 0cc7da38-6d74-4a55-8773-e706f59cb82f
            branches:
                - "*/master"
            # tmp/manifest is never used, the real manifest repo is placed in aosp/.repo/manifests
            basedir: tmp/manifest
            wipe-workspace: true
    triggers:
        - pollscm:
            cron: "H H(0-1) * * *"
            ignore-post-commit-hooks: True
    notifications:
        - http:
            url: http://10.251.165.223:5000/events
            format: json
            event: all
            timeout: 10000
            log: 0
    wrappers:
        - credentials-binding:
            - username-password-separated:
                credential-id: 50aa7e90-b0b6-40e6-bcb5-6189eb0bf574
                username: JENKINS_USER
                password: JENKINS_API_PASSWORD
    builders:
      - shell:
            !include-raw:
                - bootstrap_vcc_ci.sh
      - multijob:
          name: Build
          condition: ALWAYS
          projects:
            - name: ihu_daily_build_vcc_eng
              current-parameters: true
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
            - name: ihu_daily_build_vcc_userdebug
              current-parameters: true
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
            - name: ihu_daily_build_vcc_user
              current-parameters: true
              kill-phase-on: NEVER
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
      - multijob:
          name: Test
          condition: ALWAYS
          projects:
            - name: ihu_daily_test-generic
              current-parameters: true
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
            - name: ihu_daily_test-flexray
              current-parameters: true
              kill-phase-on: NEVER
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
            - name: ihu_daily_test-audio
              current-parameters: true
              kill-phase-on: NEVER
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
            - name: ihu_daily_test-apix
              current-parameters: true
              kill-phase-on: NEVER
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}   
      - multijob:
          name: VTS
          condition: ALWAYS
          projects:
            - name: ihu_daily_vts1-generic
              current-parameters: true
              kill-phase-on: NEVER
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
            - name: ihu_daily_vts2-generic
              current-parameters: true
              kill-phase-on: NEVER
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
            - name: ihu_daily_vts3-generic
              current-parameters: true
              kill-phase-on: NEVER
              predefined-parameters: |
                UPSTREAM_JOB_GIT_REVISION=${GIT_COMMIT}
                UPSTREAM_JOB_GIT_URL=${GIT_URL}
      - copyartifact:
          project: ihu_daily_test-generic
          target: ihu_daily_test-generic_results/
          which-build: multijob-build
          optional: true
          flatten: true
      - copyartifact:
          project: ihu_daily_test-flexray
          target: ihu_daily_test-flexray_results/
          which-build: multijob-build
          optional: true
          flatten: true
      - copyartifact:
          project: ihu_daily_test-audio
          target: ihu_daily_test-audio_results/
          which-build: multijob-build
          optional: true
          flatten: true
      - copyartifact:
          project: ihu_daily_test-apix
          target: ihu_daily_test-apix_results/
          which-build: multijob-build
          optional: true
          flatten: true  
      - copyartifact:
          project: ihu_daily_vts1-generic
          target: ihu_daily_vts/1/
          which-build: multijob-build
          optional: true
          flatten: true
      - copyartifact:
          project: ihu_daily_vts2-generic
          target: ihu_daily_vts/2/
          which-build: multijob-build
          optional: true
          flatten: true
      - copyartifact:
          project: ihu_daily_vts3-generic
          target: ihu_daily_vts/3/
          which-build: multijob-build
          optional: true
          flatten: true
      - shell:
            !include-raw:
                - bootstrap_ihu_hourly_daily_common.sh    

- job:
    name: ihu_daily_build_vcc_eng
    defaults: daily_job_defaults
    node: daily_build
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily
            description: UPSTREAM_JOB can be used to fetch info about ihu_daily.
    properties:
        - build-discarder:
            days-to-keep: 30
            artifact-days-to-keep: 30
        - raw:
            xml: |
                <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@1.25">
                    <autoRebuild>false</autoRebuild>
                    <rebuildDisabled>false</rebuildDisabled>
                </com.sonyericsson.rebuild.RebuildSettings>
    builders:
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_build_eng.sh
    publishers:
        - raw:
            xml: |
                <jenkinsci.plugins.influxdb.InfluxDbPublisher plugin="influxdb@1.14">
                <selectedTarget>influxdb</selectedTarget>
                <customProjectName>IhuDaily_ihu_daily_build_vcc_eng</customProjectName>
                <customPrefix>IhuDaily</customPrefix>
                </jenkinsci.plugins.influxdb.InfluxDbPublisher>

- job:
    name: ihu_daily_build_vcc_userdebug
    defaults: daily_job_defaults
    node: daily_build
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily
            description: UPSTREAM_JOB can be used to fetch info about ihu_daily.
    properties:
        - build-discarder:
            days-to-keep: 30
            artifact-days-to-keep: 30
        - raw:
            xml: |
                <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@1.25">
                    <autoRebuild>false</autoRebuild>
                    <rebuildDisabled>false</rebuildDisabled>
                </com.sonyericsson.rebuild.RebuildSettings>
    builders:
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_build_userdebug.sh

- job:
    name: ihu_daily_build_vcc_user
    defaults: daily_job_defaults
    node: daily_build
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily
            description: UPSTREAM_JOB can be used to fetch info about ihu_daily.
    properties:
        - build-discarder:
            days-to-keep: 30
            artifact-days-to-keep: 30
        - raw:
            xml: |
                <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@1.25">
                    <autoRebuild>false</autoRebuild>
                    <rebuildDisabled>false</rebuildDisabled>
                </com.sonyericsson.rebuild.RebuildSettings>
    builders:
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_build_user.sh


- job:
    name: ihu_daily_test-generic
    defaults: daily_job_defaults
    node: daily_test-generic
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily_build_vcc_eng
            description: parameter 'UPSTREAM_JOB_RESULT' will be used to validate if the daily build has passed.
    builders:
        - config-file-provider:
            files:
                - file-id: 61535809-5c5c-4721-9a65-e3587159647a
                  target: $HOME/lab_config.json
                  variable: IPM_MAP_FILE
        - shell: |
            if [ "$UPSTREAM_JOB_RESULT" != "SUCCESS" ]
            then
                echo "Daily build ihu_vcc-eng failed!!!"
                exit 1
            fi
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_test_common.sh
    publishers:
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vcc_test_results/vcc_test_results*.tar.gz'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'
        - raw:
            xml: |
                <jenkinsci.plugins.influxdb.InfluxDbPublisher plugin="influxdb@1.14">
                <selectedTarget>influxdb</selectedTarget>
                <customProjectName>IhuDaily_ihu_daily_test-generic</customProjectName>
                <customPrefix>IhuDaily</customPrefix>
                </jenkinsci.plugins.influxdb.InfluxDbPublisher>

- job:
    name: ihu_daily_test-flexray
    defaults: daily_job_defaults
    node: daily_test-flexray
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily_build_vcc_eng
            description: parameter 'UPSTREAM_JOB_RESULT' will be used to validate if the daily build has passed.
    builders:
        - config-file-provider:
            files:
                - file-id: 61535809-5c5c-4721-9a65-e3587159647a
                  target: $HOME/lab_config.json
                  variable: IPM_MAP_FILE
        - shell: |
            if [ "$UPSTREAM_JOB_RESULT" != "SUCCESS" ]
            then
                echo "Daily build ihu_vcc-eng failed!!!"
                exit 1
            fi
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_test_common.sh
    publishers:
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vcc_test_results/vcc_test_results*.tar.gz'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'

- job:
    name: ihu_daily_test-audio
    defaults: daily_job_defaults
    node: daily_test-audio
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily_build_vcc_eng
            description: parameter 'UPSTREAM_JOB_RESULT' will be used to validate if the daily build has passed.
    builders:
        - config-file-provider:
            files:
                - file-id: 61535809-5c5c-4721-9a65-e3587159647a
                  target: $HOME/lab_config.json
                  variable: IPM_MAP_FILE
        - shell: |
            if [ "$UPSTREAM_JOB_RESULT" != "SUCCESS" ]
            then
                echo "Daily build ihu_vcc-eng failed!!!"
                exit 1
            fi
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_test_common.sh
    publishers:
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vcc_test_results/vcc_test_results*.tar.gz'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'

- job:
    name: ihu_daily_test-apix
    defaults: daily_job_defaults
    node: daily_test-apix
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily_build_vcc_eng
            description: parameter 'UPSTREAM_JOB_RESULT' will be used to validate if the daily build has passed.
    builders:
        - config-file-provider:
            files:
                - file-id: 61535809-5c5c-4721-9a65-e3587159647a
                  target: $HOME/lab_config.json
                  variable: IPM_MAP_FILE
        - shell: |
            if [ "$UPSTREAM_JOB_RESULT" != "SUCCESS" ]
            then
                echo "Daily build ihu_vcc-eng failed!!!"
                exit 1
            fi
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_test_common.sh
    publishers:
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vcc_test_results/vcc_test_results*.tar.gz'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'

- job:
    name: ihu_daily_vts1-generic
    defaults: daily_job_defaults
    node: daily_test-generic
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily_build_vcc_eng
            description: parameter 'UPSTREAM_JOB_RESULT' will be used to validate if the daily build has passed.
    builders:
        - config-file-provider:
            files:
                - file-id: 61535809-5c5c-4721-9a65-e3587159647a
                  target: $HOME/lab_config.json
                  variable: IPM_MAP_FILE
        - shell: |
            if [ "$UPSTREAM_JOB_RESULT" != "SUCCESS" ]
            then
                echo "Daily build ihu_vcc-eng failed!!!"
                exit 1
            fi
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_vts.sh
    publishers:
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vts/android-vts/results/*.zip'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vts/android-vts/logs/*/*/*.gz'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'

- job:
    name: ihu_daily_vts2-generic
    defaults: daily_job_defaults
    node: daily_test-generic
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily_build_vcc_eng
            description: parameter 'UPSTREAM_JOB_RESULT' will be used to validate if the daily build has passed.
    builders:
        - config-file-provider:
            files:
                - file-id: 61535809-5c5c-4721-9a65-e3587159647a
                  target: $HOME/lab_config.json
                  variable: IPM_MAP_FILE
        - shell: |
            if [ "$UPSTREAM_JOB_RESULT" != "SUCCESS" ]
            then
                echo "Daily build ihu_vcc-eng failed!!!"
                exit 1
            fi
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_vts.sh
    publishers:
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vts/android-vts/results/*.zip'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vts/android-vts/logs/*/*/*.gz'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'

- job:
    name: ihu_daily_vts3-generic
    defaults: daily_job_defaults
    node: daily_test-generic
    parameters:
        - run:
            name: UPSTREAM_JOB
            project-name: ihu_daily_build_vcc_eng
            description: parameter 'UPSTREAM_JOB_RESULT' will be used to validate if the daily build has passed.
    builders:
        - config-file-provider:
            files:
                - file-id: 61535809-5c5c-4721-9a65-e3587159647a
                  target: $HOME/lab_config.json
                  variable: IPM_MAP_FILE
        - shell: |
            if [ "$UPSTREAM_JOB_RESULT" != "SUCCESS" ]
            then
                echo "Daily build ihu_vcc-eng failed!!!"
                exit 1
            fi
        - shell:
            !include-raw:
                - bootstrap_ihu_daily_common.sh
                - bootstrap_common_time_triggered.sh
                - bootstrap_ihu_daily_vts.sh
    publishers:
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vts/android-vts/results/*.zip'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'
        - archive:
            artifacts: 'aosp/out/host/linux-x86/vts/android-vts/logs/*/*/*.gz'
            allow-empty: 'true'
            latest-only: 'true'
            only-if-success: 'false'
            
