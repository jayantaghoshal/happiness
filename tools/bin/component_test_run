#!/bin/sh
set -ue
SCRIPT_DIR=$(cd "$(dirname "$(readlink -f "$0")")"; pwd)
REPO_ROOT_DIR="${SCRIPT_DIR}"/../..

# Always run mypy for type checking on files in current dir before running VTS.
# Running VTS is slow and error messages from inside VTS are super confusing so better to catch silly mistakes early
export MYPYPATH=$PYTHONPATH:$(pwd)
export MYPYPATH=$MYPYPATH:$ANDROID_BUILD_TOP/test
PY_FILES=$(find . -name "*.py" -printf '%P\n')
if [ ! -z "$PY_FILES" ]; then
    mypy --py2 --config="${SCRIPT_DIR}/mypy_component_test_run.ini" $PY_FILES
fi

# Run the test
python3 "$REPO_ROOT_DIR"/tools/ci/shipit/tester.py run --verbose -c ihu-generic adb mp-serial vip-serial --test_component=.