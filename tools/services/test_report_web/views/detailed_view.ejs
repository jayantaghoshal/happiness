<html>
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/vnd.microsoft.icon" href="/volvo_logo.png"/>
    <title>VCC test report</title>
    <link rel='stylesheet' href='/css/bootstrap.min.css'>
    <script src="/js/jquery-3.2.1.js" ></script>
    <script src='/js/bootstrap.min.js'></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/solid.css" integrity="sha384-v2Tw72dyUXeU3y4aM2Y0tBJQkGfplr39mxZqlTBDUZAb9BGoC40+rdFCG0m10lXk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/fontawesome.css" integrity="sha384-q3jl8XQu1OpdLgGFvNRnPdj5VIlCvgsDQTQB6owSOHWlAurxul7f+JpUOVdAiJ5P" crossorigin="anonymous">
    <link rel='stylesheet' href='/css/user_defined.css'>    
</head>

<body>
    <%- include navbar.ejs %>
    
    <div class="container">
    <%if (test_detail["Top Job"]==""){%>
        <a href=<%="/tests/?top_job_name=" + "ihu_gate" + "&build_number=" + test_detail["test_job_build_number"] %> style="font-size:3em; color:#15317E;"><i class="fas fa-arrow-alt-circle-left"></i></a>
    <%}else{%>
        <a href=<%="/tests/?top_job_name=" + test_detail["Top Job"] + "&build_number=" + test_detail["top_test_job_build_number"] %> style="font-size:3em; color:#15317E;"><i class="fas fa-arrow-alt-circle-left"></i></a>
    <%}%>
            <h1 style="text-align:center; "><%= test_detail["Module"]%></h1>
            <fieldset>    	
                    <legend>Meta Data</legend>
                        <div class="user_defined_table">
                            <table>
                                <tr><td>Descripion:</td><td style="font-weight:bold"><%= test_detail["description"]%></td></tr>
                                <tr><td>Result :</td>
                                    <% if (test_detail["Result"]){ %>
                                                <td><span class="badge badge-success">Success</span></td>
                                    <% }else{ %>
                                                <td><span class="badge badge-danger">Failure</span></td>
                                    <% } %>
                                </tr>
                                <tr>
                                    <td>Build number :</td>
                                    <td style="font-weight:bold">
                                        <a href=<%="/tests/?top_job_name=" + test_detail["Top Job"] + "&build_number=" + test_detail["top_test_job_build_number"] %>>
                                            <%= test_detail["top_test_job_build_number"]%>
                                        </a>
                                    </td>
                                </tr>
                                <tr><td>Test Directory :</td><td style="font-weight:bold"><%= test_detail["Test Directory"]%></td></tr>
                                <tr><td>Test Type :</td><td style="font-weight:bold"><%= test_detail["Test Type"]%></td></tr>
                                <tr><td>Host :</td><td style="font-weight:bold"><a href=<%= "https://icup_android.jenkins.cm.volvocars.biz/computer/" + test_detail["Host"]%>><%= test_detail["Host"]%></td></tr>
                                <tr><td>Test Job :</td><td style="font-weight:bold"><a href=<%= "https://icup_android.jenkins.cm.volvocars.biz/job/" + test_detail["Test Job"] + "/" + test_detail["test_job_build_number"]%>><%= test_detail["Test Job"]%></td></tr>
                                <tr><td>Top Job :</td><td style="font-weight:bold"><a href=<%= "https://icup_android.jenkins.cm.volvocars.biz/job/" + test_detail["Top Job"] + "/" + test_detail["top_test_job_build_number"]%>><%= test_detail["Top Job"]%></td></tr>
                                <tr><td>Capabilities :</td><td style="font-weight:bold"><%= test_detail["Capabilities"]%></td></tr>
                                <tr><td>Started at:</td><td style="font-weight:bold"><%= test_detail["started_at"]%></td></tr>
                                <tr><td>Runtime :</td><td style="font-weight:bold"><%= Math.round(test_detail["Runtime"] / 1000)%> sec</td></tr>

                            </table>
                        </div>
            </fieldset>	
            <br>
            <%if(typeof test_detail["KPI"] !== 'undefined' && Object.keys(test_detail["KPI"]).length){%>
                <fieldset >    	
                        <legend>KPIs</legend>
                        <div class="user_defined_table">
                            <table class="table table-hover table-striped table-bordered display">
                                <thead>
                                    <tr style="color:white;background-color:#15317E;">
                                        <th>Attribute</th>
                                        <th>Value</th>
                                    </tr>
                                </thead>
                                <% for (var i in test_detail["KPI"]){%>
                                    <tr><td><%= i %> </td><td style="font-weight:bold;"><%= test_detail["KPI"][i]%></td></tr>
                                <%}%>
                            </table>
                        </div>
                </fieldset>
            <%}%>
            <br>
            <%if(test_detail["Test Type"] == "vts" || test_detail["Test Type"] == "AndroidVTS" ){%>
                <fieldset >    	
                        <legend>Sub Tests</legend>
                            <%if (testcases_test_record.length>0){%>
                            <table class="table table-hover table-striped table-bordered display" >
                                <thead>
                                    <tr style="color:white;background-color:#15317E;">
                                        <th>Test Modules</th>
                                        <th>Tests</th>
                                        <th>Result</th>
                                    </tr>
                                    
                                    
                                    
                                </thead>
                                <tbody>
                                <% for (var i in testcases_test_record){ %>
                                        <%for(var j in testcases_test_record[i]["tests"]){%>
                                        <tr>
                                            <% if(j==0){%>
                                            <td rowspan=<%=testcases_test_record[i]["tests"].length %> > <%= testcases_test_record[i]["testcase_name"]%></td>
                                            <%}%>
                                            <td><%=testcases_test_record[i]["tests"][j]["name"]%></td>
                                            <% if (testcases_test_record[i]["tests"][j]["status"]=="pass"){ %>
                                            <td><span class="badge badge-success">Success</span></td>
                                            <% } %>
                                            <% if (testcases_test_record[i]["tests"][j]["status"]!="pass"){ %>
                                            <td><span class="badge badge-danger">Failure</span></td>
                                            <% } %>
                                        </tr>   
                                        <%}%>
                                    <%}%>
                                </tbody>
                            </table>
                            <%}%>
                </fieldset>	
            <% } %>
            <%if(test_detail["Test Type"] == "tradefed"){%>
                <fieldset>    	
                            <legend>Sub Tests</legend>
                                <%if (testcases_test_record.length>0){%>
                                <table class="table table-hover table-striped table-bordered display">
                                    <thead>
                                        <tr style="color:white;background-color:#15317E;">
                                            <th>Test Modules</th>
                                            <th>Class</th>
                                            <th>Result</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    <% for (var i in testcases_test_record){%>
                                        <tr>
                                            <td><%=testcases_test_record[i]["testcase_name"]%></td>
                                            <td><%=testcases_test_record[i]["classname"]%></td>
                                            <%if (testcases_test_record[i]["failure_log"]){%>
                                                <td><span class="badge badge-danger">Failure</span></td>
                                            
                                            <%}else{%>
                                                <td><span class="badge badge-success">Success</span></td>
                                            <%}%>
                                        </tr>
                                    <%}%>
                                    </tbody>
                                </table>        
                                <%}%>        
                </fieldset>	                        
            <% } %>
            <br>

            <fieldset style="min-width: -webkit-min-content;">
            <legend>Build trend</legend>
                <table class="table table-hover table-striped table-bordered display table-sm">
                    <tr>
                        <td style="font-weight:bold;color:white;background-color:#15317E;">Build ID:</td>
                        <% for (var i in build_trend) { %>
                        <td>
                            <a href=<%= "/detailed_view?module_name=" + module_name +"&job_name=" + test_job_name + "&build_number=" + build_trend[i]["test_job_build_number"]  +"&test_dir_name=" + encodeURI(test_detail["Test Directory"])  %> >
                                <%=build_trend[i]["test_job_build_number"]%>
                            </a>
                        </td>
                        <% } %>
                    </tr>
                    <tr>
                        <td style="font-weight:bold;color:white;background-color:#15317E;">Status:</td>
                        <% for (var i in build_trend) { %>
                        <td>
                            <% if (build_trend[i]["result"]){ %>
                                        <span class="badge badge-success">PASS</span>
                            <% }else{ %>
                                        <span class="badge badge-danger">FAIL</span>
                            <% } %>
                        </td>

                        <% } %>
                    </tr>
                    <tr>
                        <td style="font-weight:bold;color:white;background-color:#15317E;">Test time (sec): </td>
                        <% for (var i in build_trend) { %>
                        <td><%=Math.round(build_trend[i]["runtime"] / 1000)%></td>
                        <% } %>
                    </tr>
                </table>
                <table>
                    <% for (var i=0;i < notable_events.length; i++) {
                        var trendEvent = notable_events[i];
                    %>
                    <tr>
                        <td><%=trendEvent["name"] %></td>
                        <td>
                            <% if (trendEvent["value"]) { %>
                            <a href="<%= "/detailed_view?module_name=" + module_name +"&job_name=" + test_job_name + "&build_number=" + trendEvent["value"]["test_job_build_number"]  +"&test_dir_name=" + encodeURI(test_detail["Test Directory"])  %>"" >
                                <%=trendEvent["value"]["test_job_build_number"] %> --- <%=trendEvent["value"]["started_at"] %>
                            </a>
                            <% } else { %>
                                Never
                            <% } %>
                        </td>
                    </tr>
                    <%
                    }
                    %>
                </table>
            </fieldset>
            <br>
            <%if(typeof test_detail["logs"] !== 'undefined' && Object.keys(test_detail["logs"]).length){%>
                <fieldset >    	
                        <legend>Logs</legend>
                            <div class="list-group">
                                <% Object.keys(test_detail["logs"]).forEach(function(key) {%>
                                <a class="list-group-item list-group-item-action" href="<%= "/log?id=" + test_detail['logs'][key]['id'] %>">
                                    <i class="fas fa-file-alt"></i>
                                    <%= key +" "%>
                                    <span class="badge badge-secondary"><%= Math.ceil(test_detail['logs'][key]["size"] / 1024) %> kb</span>
                                </a>
                                <% }); %>
                            </div>

                </fieldset>
            <%}%>
            <%if(typeof test_detail["screenshots"] !== 'undefined' && Object.keys(test_detail["screenshots"]).length){%>
                <fieldset >
                    <legend>Screenshots on test failure</legend>
                    <div class="list-group">
                        <% Object.keys(test_detail["screenshots"]).forEach(function(key) {%>
                        <a class="list-group-item list-group-item-action" href="<%= "/screenshot?id=" +  test_detail["screenshots"][key] %>">
                            <i class="fas fa-file-alt"></i>
                            <%= key +" "%>
                        </a>
                        <% }); %>
                    </div>

                </fieldset>
            <%}%>
            <br>		
    </div>
            
     
    
</body>

</html>