component-test-spec-ip-service.txt
Created on: Jun 7, 2016


Prerequisites
-------------

Build the command line client (enhanced_pos_cli_server)
Upload to VCM. Suggested placement: /home/root (~)


Abbreviations
-------------

'System' =
IHU with working connection to VCM, TEM, and YOUR PC, unless otherwise stated.

'Start cli client' =
export COMMONAPI_DBUS_CONFIG=/etc/commonapi-dbus/common-api-dbus-config.ini; /home/root/enhanced_pos_cli_server

Success of the first test case "common_api_connection" is assumed for all other test cases.
No point in going on with other tests otherwise.


TEST_CASE("common_api_connection")

Start system.

Run DLT log viewer connected to the system.
Ensure INFO evel logging is enabled for enhanced position service in infotainment-ip-service application.
(EPOS context id, IIPS application id)

Start cli server.

infotainment-ip-service (enhanced_pos_client.cpp) does continuously check for service availability.
Upon successful connection to server, it logs (DLT):
"Enhanced position service is available."

Ensure the above message is seen!

Upon failing connection the DLT logs for enhanced position service will either contain
a: nothing at all, or 
b: "Enhanced position service is not (no longer) available."
(a ==> Wrong DLT log levels, or notification of service availability never received, e.g. server not running)
(b ==> Attempt to connect to service fail or connection interrupted, e.g. server has stopped or crashed)


TEST_CASE("param_update")

Start system.

Run DLT log viewer connected to the system.
Ensure VERBOSE level logging is enabled for enhanced position service in infotainment-ip-service application.
(EPOS context id, IIPS application id)

Start cli server.

DLT logs should be seen with one seconds frequency log all dead reckoning parameters and notifications should be sent to TEM.

Ensure the frequency is correct.
Ensure the time is incremented correctly.
NOTE! The test server intentionally sends update once per FIVE seconds to make manual parameter comparisons easier.
      Thus the parameters values in DLT log will only change every FIFTH time.
Ensure that acks are recived from TEM for the notifications.


TEST_CASE("param_update_no_server")

Start system.

Run DLT log viewer connected to the system.
Ensure VERBOSE level logging is enabled for enhanced position service in infotainment-ip-service application.
(EPOS context id, IIPS application id)

_DO NOT_ start cli server.

DLT logs should be seen with one seconds frequency log all dead reckoning parameters and notifications should be sent to TEM.

Ensure the logs show default values in accordance with requirements (addendum ICUPN-5638971-160616-0934-2.pdf):

lat/lon = 0 
if not yet available provide 0).
heading = 0
speedKmph = 255 (unknown)
hdopX10 = 255 (unknown) 
numSat = 127 (unknown) .
fixTime = [2015, 01, 01, 00:00:00]
fixType = notAvailable
drType = noDr
drDistance = 0

Ensure the frequency is correct.
Ensure that acks are recived from TEM for the notifications.


TEST_CASE("server_reconnect 1")

Start system.

Run DLT log viewer connected to the system.
Ensure VERBOSE level logging is enabled for enhanced position service in infotainment-ip-service application.
(EPOS context id, IIPS application id)

Start cli server.

DLT logs should be seen with one seconds frequency log all dead reckoning parameters and notifications sent to TEM.
(Verification of this has already been covered in previous tests.)

Stop cli server.

Ensure that the lost connection is recognized by log "Enhanced position service is not (no longer) available."

DLT logs should still be seen with one seconds frequency log all dead reckoning parameters and notifications should be sent to TEM.

Ensure the frequency is correct.
Ensure that acks are recived from TEM for the notifications.
Ensure the fix type in DLT logs changes to 'not available'.


TEST_CASE("server_reconnect 2")

Continue directly from previous test case!

Ensure the re-connection is recognized by log "Enhanced position service is available."

DLT logs should still be sent with one seconds frequency log all dead reckoning parameters and notifications should be sent to TEM.

Ensure the frequency is correct.
Ensure the latest parameters from server are used, e.g. verifying that time is incremented correctly.
NOTE! The test server intentionally sends update once per FIVE seconds to make manual parameter comparisons easier.
      Thus the parameters values in DLT log will only change every FIFTH time.
Ensure that acks are recived from TEM for the notifications.


TEST_CASE("valid parameter values")

Start system.

Run DLT log viewer connected to the system.
Ensure VERBOSE level logging is enabled for enhanced position service in infotainment-ip-service application.
(EPOS context id, IIPS application id)

Start cli server.

Verify by comparing DLT logs against debug printouts from cli server,
that infotainment-ip-service sends the same/equivalent values as it received from server.


TEST_CASE("disconnect_tem")

Start system.

Run DLT log viewer connected to the system.
Ensure VERBOSE level logging is enabled for enhanced position service in infotainment-ip-service application.
(EPOS context id, IIPS application id)

Start cli server.

DLT logs should be seen with one seconds frequency log all dead reckoning parameters and notifications should be sent to TEM.
(Verification of this has already been covered in previous tests.)

Disconnect TEM, or use iptables to block it's ip address.

Wait a while.

(No acks will be receive on the notifications now.)

Reconnect TEM.

DLT logs should be seen with one seconds frequency log all dead reckoning parameters and notifications should be sent to TEM.
Ensure that acks are recived from TEM for the notifications.
