component-test-spec-ip-service.txt
Created on: Jun 7, 2016


Prerequisites
-------------

Build the command line client (gnss_cli_client)
Upload to VCM. Suggested placement: /home/root (~)


Abbreviations
-------------

'System' =
IHU with working connection to VCM, and YOUR PC, unless otherwise stated.

'Start cli client' =
export COMMONAPI_DBUS_CONFIG=/etc/commonapi-dbus/common-api-dbus-config.ini; /home/root/gnss_cli_client

Success of the first test case "gnss_common_api_connection" is assumed for all other test cases.
No point in going on with other tests otherwise.


TEST_CASE("gnss_common_api_connection")

Start system.

Start cli client.

Client will check for GNSS (CommonAPI) service availability, printing
'Checking availability!'

It should within a few seconds continously print a screen with GNSS parameters, example:
"
Got updated UTC time:           [2000-1-1T0:5:35+00:00]
Got updated GPS system time:        [week: 0, time of week: 351000]
...
"

If the screen does not appear, either the availability check, and or connection to service has failed.


TEST_CASE("gnss_param_update")

Start system.
Start cli client.

It should within a few seconds continously print a screen with GNSS parameters, excample:
"
Got updated UTC time:           [2000-1-1T0:5:35+00:00]
Got updated GPS system time:        [week: 0, time of week: 351000]
...
"

Verify that the UTC time contains a valid time value and is continously incremented.


TEST_CASE("gnss_get_all_parameter_groups")

Start system.
Start cli client.

It should within a few seconds continously print a screen with GNSS parameters, example:
"
Got updated UTC time:           [2000-1-1T0:5:35+00:00]
Got updated GPS system time:        [week: 0, time of week: 351000]
Got updated GPS position:       [position: (57.73,11.8561), altidude: 51.5m]
Got updated movement:           [speed: 0m/s, horizontal velocity: 0 m/s, vertical velocity: 0m/s]
Got updated heading:            [(0) degrees from true north]
Got updated GNSS status:        [GPS: N, GLONASS: N, Galileo: N, SBAS: N, qzssL1: N, qzssL1SAIF: N]
Got updated positioning status:     [Fix type: 'Startup Mode', DGPS is used: N, self ephemeris data usage: N]
Got updated satellite usage:        Satellites VISIBLE:     [GPS: 0, GLONASS: 0, Galileo: 0, SBAS: 0, qzssL1: 0, qzssL1SAIF: 0]
                    Satellites USED:    [GPS: 0, GLONASS: 0, Galileo: 0, SBAS: 0, qzssL1: 0, qzssL1SAIF: 0]

Got updated precision:          [HDOP: 0, VDOP: 0, PDOP: 0, TDOP: 0]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got channel data:           [PRN: 1,    TS: Searching,  SVACC: 0,   SNR (dB): 0,    AZ angle: 0,    ELV angle: 0,   ExData: NOT IMPLEMENTED]
Got updated UTC time:           [2000-1-1T0:5:35+00:00]
Got updated GPS system time:        [week: 0, time of week: 351000]
"

Verify that all parameter groups ('Got xxx:') from above example are included!
(Each parameter group is represented by one CommonAPI broadcast operation.)
If any parameter group is not seen, it means that service has not provided this information.


TEST_CASE("gnss_valid_values")

Test specific prerequisites:

Ensure the VCM has WORKING MAM (Antenna Module) SETUP AND GOOD SATELLITE COVERAGE.
NOTE! Just plugin in any MAM to VCM may not be sufficient!

If all values besides time are at zero/default value, then it is likely that the MAM setup is not working, or having no satellite coverage.

NOTE! Default value for GPS position may either be all zeroes or Volvo Torslanda location: 'position: (57.73,11.8561), altidude: 51.5m'),


Test instructions:

Start system.
Start cli client.

It should within a few seconds continously print a screen with GNSS parameters, example:
...

FIRST TIME DOING TEST:
Verify that all parameters are included, against Infotainment Ip Bus specification for operation 'GNSSPositionData (0x0902)'
OTHERWISE:
Verify that all parameters are included, against Infotainment Ip Bus specification for operation 'GNSSPositionData (0x0902)',
or against above example.

Exceptions:
The five extended data parameters (ExData:) are not oficially supported at this stage and may be skipped.


TEST_CASE("disconnect_vcm")

Start system.
Start cli client.
Disconnect VCM, or use iptables to block it's ip address.

Ensure the fix type changes to 'not available', example:
"
Got updated positioning status:     [Fix type: 'Not Available', DGPS is used: N, self ephemeris data usage: N]
"

NOTE! With current limitations of software (no link manager support),
      it will take about 25 seconds until the status changes (notification wait timeout + 7 ack timeouts for sent request)!           


TEST_CASE("reconnect_vcm")

Test specific prerequisites:

Continue directly from previous test case.

Reconnect back VCM.
Ensure fix type changes back to the previous value and that time is continously incremented again.





